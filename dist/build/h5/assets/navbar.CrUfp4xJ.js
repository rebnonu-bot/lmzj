import{G as t,e,f as s,j as i,b as l,w as n,i as a,x as o,v as c,k as h,R as u,l as r,m as d,t as f,s as g}from"./index-8WK0Ux_r.js";import{s as C,u as p,_,p as m,e as x,t as b,a as B}from"./icon.CNXA9uzs.js";const y={animation:{type:Boolean,default:!0},delta:{type:Number,default:1},fixed:{type:Boolean,default:!0},leftArrow:Boolean,placeholder:Boolean,safeAreaInsetTop:{type:Boolean,default:!0},title:{type:String},titleMaxLength:{type:Number},visible:{type:Boolean,default:!0},zIndex:{type:Number,default:1},onComplete:{type:Function,default:()=>({})},onFail:{type:Function,default:()=>({})},onGoBack:{type:Function,default:()=>({})},onRightClick:{type:Function,default:()=>({})},onSuccess:{type:Function,default:()=>({})}},$=`${m}-navbar`,R={width:87,height:32,top:24,right:C.windowWidth-10};const v=B(p({name:$,options:{styleIsolation:"shared"},externalClasses:[`${m}-class`,`${m}-class-placeholder`,`${m}-class-content`,`${m}-class-title`,`${m}-class-left`,`${m}-class-center`,`${m}-class-left-icon`,`${m}-class-home-icon`,`${m}-class-capsule`,`${m}-class-nav-btn`],components:{TIcon:_},props:{...y},emits:["fail","complete","success","go-back","right-click"],data:()=>({timer:null,prefix:m,classPrefix:$,boxStyle:"",showTitle:"",hideLeft:!1,hideCenter:!1,_menuRect:null,_leftRect:null,_boxStyle:{},tools:b,visibleClass:""}),computed:{leftArrowCustomStyle:()=>"font-size: var(--td-navbar-left-arrow-size, 24px);"},watch:{visible(t){const{animation:e}=this,s=`${$}${t?"--visible":"--hide"}`;this.visibleClass=`${s}${e?"-animation":""}`,this.timer&&clearTimeout(this.timer),e&&(this.timer=setTimeout(()=>{this.visibleClass=s},300))},title:"onWatchTitle",titleMaxLength:"onWatchTitle"},mounted(){this.onWatchTitle(),this.initStyle(),this.getLeftRect(),this.onMenuButtonBoundingClientRectWeightChange()},beforeUnMount(){this.offMenuButtonBoundingClientRectWeightChange()},methods:{initStyle(){this.getMenuRect();const{_menuRect:t,_leftRect:e}=this;if(!t||!e||!C)return;const s={"--td-navbar-padding-top":`${C.statusBarHeight}px`,"--td-navbar-right":C.windowWidth-t.left+"px","--td-navbar-left-max-width":`${t.left}px`,"--td-navbar-capsule-height":`${t.height}px`,"--td-navbar-capsule-width":`${t.width}px`,"--td-navbar-height":`${2*(t.top-C.statusBarHeight)+t.height}px`};delete s["--td-navbar-height"],this.calcCenterStyle(e,t,s)},onWatchTitle(){const{title:t}=this,e=this.titleMaxLength||Number.MAX_SAFE_INTEGER;let s=t.slice(0,e);e<t.length&&(s+="..."),this.showTitle=s},calcCenterStyle(t,e,s){const i=Math.max(t.right,C.windowWidth-e.left),l={...s,"z-index":this.zIndex,"--td-navbar-center-left":`${i}px`,"--td-navbar-center-width":`${Math.max(e.left-i,0)}px`},n=Object.entries(l).map(([t,e])=>`${t}: ${e}`).join("; ");this.boxStyle=n,this._boxStyle=l},getLeftRect(){x(this,`.${$}__left`).then(t=>{t.right>this._leftRect.right&&this.calcCenterStyle(t,this._menuRect,this._boxStyle)})},getMenuRect(){let t={...R,bottom:R.top+R.height,left:R.right-R.width};uni.getMenuButtonBoundingClientRect&&"function"==typeof uni.getMenuButtonBoundingClientRect&&"object"==typeof uni.getMenuButtonBoundingClientRect()&&(t=uni.getMenuButtonBoundingClientRect()||{}),this._menuRect=t,this._leftRect={right:C.windowWidth-t.left}},onMenuButtonBoundingClientRectWeightChange(){uni.onMenuButtonBoundingClientRectWeightChange&&(this.onMenuButtonBoundingClientRectWeightChangeCallback=t=>this.queryElements(t),uni.onMenuButtonBoundingClientRectWeightChange(this.onMenuButtonBoundingClientRectWeightChangeCallback))},offMenuButtonBoundingClientRectWeightChange(){this.onMenuButtonBoundingClientRectWeightChangeCallback&&uni.offMenuButtonBoundingClientRectWeightChange(this.onMenuButtonBoundingClientRectWeightChangeCallback)},queryElements(t){Promise.all([x(this,`.${this.classPrefix}__left`),x(this,`.${this.classPrefix}__center`)]).then(([e,s])=>{const i=Math.round(e.right),l=Math.round(s.right),n=t.left;this.hideLeft=i>n,this.hideCenter=i>n||l>n})},goBack(){const{delta:e}=this,s=this;this.$emit("go-back"),e>0&&t({delta:e,fail(t){s.$emit("fail",t)},complete(t){s.$emit("complete",t)},success(t){s.$emit("success",t)}})},onClickRight(){this.$emit("right-click")}}}),[["render",function(t,C,p,m,x,b){const B=a,y=e(s("t-icon"),_),$=r;return i(),l(B,{class:o(t.tools.cls(t.classPrefix,[["fixed",t.fixed]])+" "+t.visibleClass+" "+t.tClass),style:g(t.tools._style([t.boxStyle,t.customStyle]))},{default:n(()=>[t.fixed&&t.placeholder?(i(),l(B,{key:0,class:o(t.classPrefix+"__placeholder "+t.tClassPlaceholder)},null,8,["class"])):c("",!0),h(B,{class:o(t.classPrefix+"__content "+t.tClassContent)},{default:n(()=>[h(B,{class:o(t.classPrefix+"__left "+(t.hideLeft?t.classPrefix+"__left--hide":"")+" "+t.tClassLeft)},{default:n(()=>[t.leftArrow?(i(),l(B,{key:0,class:o(t.classPrefix+"__btn"),"aria-role":"button","aria-label":"返回",onClick:t.goBack},{default:n(()=>[h(y,{name:"chevron-left","custom-style":t.leftArrowCustomStyle,"t-class":t.classPrefix+"__left-arrow"},null,8,["custom-style","t-class"])]),_:1},8,["class","onClick"])):c("",!0),u(t.$slots,"left",{},void 0,!0),h(B,{class:o(t.classPrefix+"__capsule "+t.tClassCapsule)},{default:n(()=>[u(t.$slots,"capsule",{},void 0,!0)]),_:3},8,["class"])]),_:3},8,["class"]),h(B,{class:o(t.classPrefix+"__center "+(t.hideCenter?t.classPrefix+"__center--hide":"")+" "+t.tClassCenter)},{default:n(()=>[u(t.$slots,"title",{},void 0,!0),t.title?(i(),l($,{key:0,class:o(t.classPrefix+"__center-title "+t.tClassTitle)},{default:n(()=>[d(f(t.showTitle),1)]),_:1},8,["class"])):c("",!0)]),_:3},8,["class"]),h(B,{class:o(t.classPrefix+"__right"),onClick:t.onClickRight},{default:n(()=>[u(t.$slots,"right",{},void 0,!0)]),_:3},8,["class","onClick"])]),_:3},8,["class"])]),_:3},8,["class","style"])}],["__scopeId","data-v-284e3ff2"]]);export{v as _};
