import{u as t,p as e,_ as s,n as i,t as a,a as l,c as o}from"./icon.CJOHyHK1.js";import{e as n,f as c,j as r,b as u,w as d,k as h,i as p,s as m,x as f,n as v,F as x,p as _,v as b,l as y,m as g,t as C,R as I,L as P}from"./index-PUK5Iwtz.js";import{R as k}from"./parent-map.DLFD9qfo.js";import{C as S,P as O}from"./relation.DOrZf5Wr.js";import{u as T,_ as V}from"./popup.DXni-6bZ.js";const H={format:{type:Function},options:{type:Array,default:()=>[]}},B=`${e}-picker-item`,M={ENABLE_THRESHOLD:100,BUFFER_COUNT:8,FAST_SCROLL_BUFFER:12},$=function(t,e,s){return Math.min(Math.max(t,e),s)};const F=l(t({name:B,components:{TIcon:s},options:{styleIsolation:"shared",virtualHost:!0},externalClasses:[`${e}-class`],mixins:[S(k.PickerItem)],props:{...H,useSlots:{type:Boolean,value:!0}},data:()=>({prefix:e,classPrefix:B,offset:0,duration:0,value:"",curIndex:0,columnIndex:0,keys:{},formatOptions:H.options.value,tools:a,enableVirtualScroll:!1,visibleOptions:[],virtualStartIndex:0,virtualOffsetY:0,totalHeight:0,itemHeight:40,visibleItemCount:5,wrapperPaddingY:72}),watch:{options:{handler(){this.update()},immediate:!0},keys:{handler(){this.update()},immediate:!0}},created(){this.StartY=0,this.StartOffset=0,this.startTime=0,this._animationTimer=null},mounted(){},beforeUnMount(){this._animationTimer&&(clearInterval(this._animationTimer),this._animationTimer=null)},methods:{onClickItem(t){const{index:e}=t.currentTarget.dataset,{itemHeight:s}=this,i=$(e,0,this.getCount()-1);i!==this._selectedIndex&&(this.offset=-i*s,this.curIndex=i,this.duration=200),this.updateSelected(i,!0)},onTouchStart(t){this.StartY=t.touches[0].clientY,this.StartOffset=this.offset,this.startTime=Date.now(),this.duration=0},onTouchMove(t){const{StartY:e,StartOffset:s}=this,{itemHeight:i}=this,a=t.touches[0].clientY-e,l=$(s+a,-(this.getCount()-1)*i,0);this.offset=l},onTouchEnd(t){const{offset:e,itemHeight:s,enableVirtualScroll:a,formatOptions:l}=this,{startTime:o}=this;if(e===this.StartOffset)return;let n=0;const c=t.changedTouches[0].clientY-this.StartY,r=Date.now()-o;r<300&&Math.abs(c)>15&&(n=((t,e)=>{let s=t;return s=Math.abs(s/e)/.005*(s<0?-1:1),s})(c,r));const u=$(e+n,-this.getCount()*s,0),d=$(Math.round(-u/s),0,this.getCount()-1),h=-d*s,p=Math.abs(h-e)/s,m=Math.min(600,300+30*p),f=Math.abs(n)>3*s?M.FAST_SCROLL_BUFFER:M.BUFFER_COUNT;if(this._animationTimer&&(clearInterval(this._animationTimer),this._animationTimer=null),this.offset=h,this.duration=m,this.curIndex=d,a){const t=Math.floor(Math.abs(e)/s),a=d,o=Math.min(t,a),n=Math.max(t,a),c=Math.max(0,o-f),r=Math.min(l.length,n+this.visibleItemCount+f);this.visibleOptions=l.slice(c,r),this.virtualStartIndex=c,this.virtualOffsetY=c*s,i().then(()=>{const t=this.computeVirtualRange(h,l.length,s,!1);this.visibleOptions=l.slice(t.startIndex,t.endIndex),this.virtualStartIndex=t.startIndex,this.virtualOffsetY=t.startIndex*s})}d!==this._selectedIndex&&this.updateSelected(d,!0)},formatOption:(t,e,s)=>"function"!=typeof s?t:t.map(t=>s(t,e)),updateSelected(t,e){var s,i,a;const{columnIndex:l,keys:o,formatOptions:n}=this;this._selectedIndex=t,this._selectedValue=null==(s=n[t])?void 0:s[null==o?void 0:o.value],this._selectedLabel=null==(i=n[t])?void 0:i[null==o?void 0:o.label],e&&(null==(a=this[k.PickerItem])||a.triggerColumnChange({index:t,column:l}))},update(){const{options:t,value:e,keys:s,format:a,columnIndex:l,itemHeight:o,visibleItemCount:n}=this,c=this.formatOption(t,l,a),r=c.length,u=r>=M.ENABLE_THRESHOLD;let d=-1;if(r>500){d=new Map(c.map((t,e)=>[t[null==s?void 0:s.value],e])).get(e)??-1}else d=c.findIndex(t=>t[null==s?void 0:s.value]===e);const h=d>0?d:0,p=(n-1)/2*o;if(this.formatOptions=c,this.offset=-h*o,this.curIndex=h,this.enableVirtualScroll=u,this.totalHeight=r*o,this.wrapperPaddingY=p,u){const t=this.computeVirtualRange(-h*o,r,o);this.visibleOptions=c.slice(t.startIndex,t.endIndex),this.virtualStartIndex=t.startIndex,this.virtualOffsetY=t.startIndex*o}else this.visibleOptions=c,this.virtualStartIndex=0,this.virtualOffsetY=0;i().then(()=>{this.updateSelected(h,!1)})},computeVirtualRange(t,e,s,i=!1){const a=Math.abs(t),{BUFFER_COUNT:l,FAST_SCROLL_BUFFER:o}=M,{visibleItemCount:n}=this,c=i?o:l,r=Math.floor(a/s);return{startIndex:Math.max(0,r-c),endIndex:Math.min(e,r+n+c)}},updateVisibleOptions(t,e=!1){const{formatOptions:s,itemHeight:i,enableVirtualScroll:a}=this;if(!a)return;const l=void 0!==t?t:this.offset,o=this.computeVirtualRange(l,s.length,i,e);o.startIndex===this.virtualStartIndex&&o.endIndex===this.virtualStartIndex+this.visibleOptions.length||(this.visibleOptions=s.slice(o.startIndex,o.endIndex),this.virtualStartIndex=o.startIndex,this.virtualOffsetY=o.startIndex*i)},getCount(){var t;return null==(t=this.options)?void 0:t.length},getCurrentSelected(){var t,e;const{offset:s,itemHeight:i,formatOptions:a,keys:l}=this,o=Math.max(0,Math.min(Math.round(-s/i),this.getCount()-1));return{index:o,value:null==(t=a[o])?void 0:t[null==l?void 0:l.value],label:null==(e=a[o])?void 0:e[null==l?void 0:l.label]}}}}),[["render",function(t,e,i,a,l,o){const k=n(c("t-icon"),s),S=y,O=p;return r(),u(O,{style:m(t.tools._style([t.customStyle,"height:"+t.itemHeight*t.visibleItemCount+"px"])),class:f(t.tools.cls(t.classPrefix+"__group",[])+" "+t.tClass),onTouchstart:t.onTouchStart,onTouchmove:P(t.onTouchMove,["stop","prevent"]),onTouchend:t.onTouchEnd,onTouchcancel:t.onTouchEnd},{default:d(()=>[h(O,{class:f(t.classPrefix+"__wrapper"),style:m("transition: transform "+t.duration+"ms cubic-bezier(0.215, 0.61, 0.355, 1); transform: translate3d(0, "+t.offset+"px, 0); padding: "+t.wrapperPaddingY+"px 0")},{default:d(()=>[t.enableVirtualScroll?(r(),u(O,{key:0,style:m("height: "+t.totalHeight+"px; position: relative;")},{default:d(()=>[h(O,{style:m("position: absolute; top: "+t.virtualOffsetY+"px; left: 0; right: 0;")},{default:d(()=>[(r(!0),v(x,null,_(t.visibleOptions,(e,s)=>(r(),u(O,{key:s,class:f(t.tools.cls(t.classPrefix+"__item",[["active",t.curIndex==t.virtualStartIndex+s]])),style:m("height: "+t.itemHeight+"px"),"data-index":t.virtualStartIndex+s,onClick:t.onClickItem},{default:d(()=>[e[t.keys.icon]?(r(),u(k,{key:0,class:f(t.classPrefix+"__item-icon"),name:e[t.keys.icon]},null,8,["class","name"])):b("",!0),h(S,{class:f(t.classPrefix+"__item-label")},{default:d(()=>[g(C(e[t.keys.label]),1)]),_:2},1032,["class"]),t.useSlots?I(t.$slots,"label-suffix--"+(t.virtualStartIndex+s),{key:1},void 0,!0):b("",!0)]),_:2},1032,["class","style","data-index","onClick"]))),128))]),_:3},8,["style"])]),_:3},8,["style"])):(r(!0),v(x,{key:1},_(t.visibleOptions,(e,s)=>(r(),u(O,{key:s,class:f(t.tools.cls(t.classPrefix+"__item",[["active",t.curIndex==s]])),style:m("height: "+t.itemHeight+"px"),"data-index":s,onClick:t.onClickItem},{default:d(()=>[e[t.keys.icon]?(r(),u(k,{key:0,class:f(t.classPrefix+"__item-icon"),name:e[t.keys.icon]},null,8,["class","name"])):b("",!0),h(S,{class:f(t.classPrefix+"__item-label")},{default:d(()=>[g(C(e[t.keys.label]),1)]),_:2},1032,["class"]),t.useSlots?I(t.$slots,"label-suffix--"+s,{key:1},void 0,!0):b("",!0)]),_:2},1032,["class","style","data-index","onClick"]))),128))]),_:3},8,["class","style"])]),_:3},8,["style","class","onTouchstart","onTouchmove","onTouchend","onTouchcancel"])}],["__scopeId","data-v-b47409d1"]]),R={autoClose:{type:Boolean,default:!0},cancelBtn:{type:[String,Boolean],default:!0},confirmBtn:{type:[String,Boolean],default:!0},header:{type:Boolean,default:!0},itemHeight:{type:Number,default:40},keys:{type:Object},popupProps:{type:Object,default:()=>({})},title:{type:String,default:""},usePopup:{type:Boolean,default:!0},usingCustomNavbar:Boolean,value:{type:Array},defaultValue:{type:Array},visible:Boolean,visibleItemCount:{type:Number,default:5},onCancel:{type:Function,default:()=>({})},onChange:{type:Function,default:()=>({})},onClose:{type:Function,default:()=>({})},onConfirm:{type:Function,default:()=>({})},onPick:{type:Function,default:()=>({})}},Y=`${e}-picker`,E={value:"value",label:"label",icon:"icon"};const w=l(t({name:Y,options:{styleIsolation:"shared"},externalClasses:[`${e}-class`,`${e}-class-confirm`,`${e}-class-cancel`,`${e}-class-title`],components:{TPopup:V},mixins:[O(k.PickerItem),T],props:{...R},emits:["visible-change","update:visible"],data(){return{prefix:e,classPrefix:Y,defaultPopUpProps:{},defaultPopUpzIndex:11500,indicatorTop:72,tools:a,dataValue:o(this.value,this.defaultValue),dataVisible:this.visible}},watch:{value:{handler(t){this.dataValue=t},immediate:!0},visible:{handler(t){this.dataVisible=t},immediate:!0},dataVisible:{handler(){this.onWatchVisible(),setTimeout(()=>{this.onWatchVisible()})},immediate:!0},dataValue:{handler(){this.onWatchVisible()},immediate:!0},itemHeight:{handler(){this.updateIndicatorPosition()},immediate:!0},visibleItemCount:{handler(){this.updateIndicatorPosition()},immediate:!0}},mounted(){var t;null==(t=this.children)||t.map((t,e)=>t.columnIndex=e),this.updateIndicatorPosition(),setTimeout(()=>{this.updateChildren()})},methods:{coalesce:o,innerAfterLinked(){this.updateChildren()},updateChildren(){var t;const{pickItemHeight:e}=this,{value:s,defaultValue:i,keys:a,visibleItemCount:l,itemHeight:n}=this;null==(t=this.children)||t.forEach((t,c)=>{t.value=o(null==s?void 0:s[c],null==i?void 0:i[c],""),t.columnIndex=c,t.pickItemHeight=e,t.itemHeight=n,t.visibleItemCount=l,t.keys={...E,...a||{}},t.update()})},getSelectedValue(){var t,e;return[null==(t=this.children)?void 0:t.map(t=>t._selectedValue),null==(e=this.children)?void 0:e.map(t=>t._selectedLabel)]},getColumnIndexes(){var t;return null==(t=this.children)?void 0:t.map((t,e)=>({column:e,index:t._selectedIndex}))},onConfirm(){const[t,e]=this.getSelectedValue(),s=this.getColumnIndexes();this.close("confirm-btn"),this.$emit("confirm",{value:t,label:e,columns:s}),JSON.stringify(this.dataValue)!==JSON.stringify(t)&&this.$emit("change",{value:t,label:e,columns:s})},triggerColumnChange({column:t,index:e}){const[s,i]=this.getSelectedValue();this.$emit("pick",{value:s,label:i,column:t,index:e})},onCancel(){this.close("cancel-btn"),this.$emit("cancel")},onPopupChange(t){const{visible:e}=t;this.close("overlay"),this.$emit("visible-change",{visible:e}),this.$emit("update:visible",e)},close(t){this.autoClose&&(this.dataVisible=!1,this.$emit("update:visible",!1)),this.$emit("close",{trigger:t})},updateIndicatorPosition(){const{itemHeight:t,visibleItemCount:e}=this,s=(e-1)/2*t;this.indicatorTop=s},onWatchVisible(){const{usePopup:t,dataVisible:e}=this;t&&!e||(this.updateChildren(),this.updateIndicatorPosition())},isShowOverlay:(t,e)=>a.isBoolean(t)?t:e}}),[["render",function(t,e,s,i,a,l){const o=p,v=n(c("t-popup"),V);return r(),u(o,null,{default:d(()=>[t.usePopup?(r(),u(v,{key:0,visible:t.dataVisible,placement:"bottom","close-on-overlay-click":t.autoClose,"show-overlay":t.isShowOverlay(t.popupProps&&t.popupProps.showOverlay,!0),"using-custom-navbar":t.usingCustomNavbar||t.popupProps&&t.popupProps.usingCustomNavbar,"custom-navbar-height":t.coalesce(t.customNavbarHeight,t.popupProps&&t.popupProps.usingCustomNavbar),"z-index":t.popupProps&&t.popupProps.zIndex||t.defaultPopUpzIndex,"overlay-props":t.popupProps&&t.popupProps.overlayProps||t.defaultPopUpProps,onVisibleChange:t.onPopupChange},{content:d(()=>[h(o,{style:m(t.tools._style([t.customStyle])),class:f(t.classPrefix+" "+t.tClass)},{default:d(()=>[t.header?(r(),u(o,{key:0,class:f(t.classPrefix+"__toolbar")},{default:d(()=>[t.cancelBtn?(r(),u(o,{key:0,class:f(t.classPrefix+"__cancel "+t.tClassCancel),onClick:t.onCancel},{default:d(()=>[g(C(t.cancelBtn),1)]),_:1},8,["class","onClick"])):b("",!0),h(o,{class:f(t.classPrefix+"__title "+t.tClassTitle)},{default:d(()=>[g(C(t.title),1)]),_:1},8,["class"]),t.confirmBtn?(r(),u(o,{key:1,class:f(t.classPrefix+"__confirm "+t.tClassConfirm),onClick:t.onConfirm},{default:d(()=>[g(C(t.confirmBtn),1)]),_:1},8,["class","onClick"])):b("",!0)]),_:1},8,["class"])):b("",!0),I(t.$slots,"header",{},void 0,!0),I(t.$slots,"content",{},void 0,!0),h(o,{class:f(t.tools.cls(t.classPrefix+"__main",[])),"disable-scroll":""},{default:d(()=>[I(t.$slots,"default",{},void 0,!0),h(o,{class:f(t.classPrefix+"__mask "+t.classPrefix+"__mask--top")},null,8,["class"]),h(o,{class:f(t.classPrefix+"__mask "+t.classPrefix+"__mask--bottom")},null,8,["class"]),h(o,{class:f(t.classPrefix+"__indicator"),style:m("height: "+t.itemHeight+"px; top: "+t.indicatorTop+"px")},null,8,["class","style"])]),_:3},8,["class"]),I(t.$slots,"footer",{},void 0,!0)]),_:3},8,["style","class"])]),_:3},8,["visible","close-on-overlay-click","show-overlay","using-custom-navbar","custom-navbar-height","z-index","overlay-props","onVisibleChange"])):(r(),u(o,{key:1,style:m(t.tools._style([t.customStyle])),class:f(t.classPrefix+" "+t.tClass)},{default:d(()=>[t.header?(r(),u(o,{key:0,class:f(t.classPrefix+"__toolbar")},{default:d(()=>[t.cancelBtn?(r(),u(o,{key:0,class:f(t.classPrefix+"__cancel "+t.tClassCancel),onClick:t.onCancel},{default:d(()=>[g(C(t.cancelBtn),1)]),_:1},8,["class","onClick"])):b("",!0),h(o,{class:f(t.classPrefix+"__title "+t.tClassTitle)},{default:d(()=>[g(C(t.title),1)]),_:1},8,["class"]),t.confirmBtn?(r(),u(o,{key:1,class:f(t.classPrefix+"__confirm "+t.tClassConfirm),onClick:t.onConfirm},{default:d(()=>[g(C(t.confirmBtn),1)]),_:1},8,["class","onClick"])):b("",!0)]),_:1},8,["class"])):b("",!0),I(t.$slots,"header",{},void 0,!0),I(t.$slots,"content",{},void 0,!0),h(o,{class:f(t.tools.cls(t.classPrefix+"__main",[])),"disable-scroll":""},{default:d(()=>[I(t.$slots,"default",{},void 0,!0),h(o,{class:f(t.classPrefix+"__mask "+t.classPrefix+"__mask--top")},null,8,["class"]),h(o,{class:f(t.classPrefix+"__mask "+t.classPrefix+"__mask--bottom")},null,8,["class"]),h(o,{class:f(t.classPrefix+"__indicator"),style:m("height: "+t.itemHeight+"px; top: "+t.indicatorTop+"px")},null,8,["class","style"])]),_:3},8,["class"]),I(t.$slots,"footer",{},void 0,!0)]),_:3},8,["style","class"]))]),_:3})}],["__scopeId","data-v-f4a6148d"]]);export{F as _,w as a};
